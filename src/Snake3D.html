<!DOCTYPE html>
<html>
<head>
	<title>Snake3D Game</title>
</head>

<body>
<div id="FULL-SCREEN" style="top:0px; left:0px;">

	<canvas id="gl-canvas" name="fs" 
	width="1400" height="700"
	style="position: absolute; top:0px; left:0px;">
	Oops ... your browser doesn't support the HTML5 canvas 	element
	</canvas>

	<text id="score" name="fs" 
	style="position: relative; top:0px;
	left:1040px; text-align: center; text-shadow: 4px 4px 0px 	darkorange; font-family: Ink Free; font-size: 140px;"
	>0</text>

	<text id="ready" name="fs" 
	style="position: fixed; top:235px;
 	left:475px; text-align: center; text-shadow: 2px 2px 0px 	darkorange; font-family: Ink Free; font-size: 60px;"
	><b>Are you ready?</b></text>

	<text id="start" name="fs" 
	style="position: fixed; top:360px;
 	left:500px; text-align: center; text-shadow: 4px 4px 0px 	white; font-family: Ink Free; font-size: 60px;"
	><b>START GAME</b></text>
	
</div>

<div id="BEST SCORE" style="top:0px; left:0px; border:1px solid #FFF;">
	
	<text id="best_score_table" style="position: absolute; 	top:252px; left:1225px; text-align: center;
	text-shadow: 1px 1px 0px gold;
	font-family: Ink Free; font-size: 15px;"
	>Best Score:</text>

	<button id = "best_score_box" style="width: 100px; 
	height: 100px; position: relative; top:55px;left:1204px;
	background-color:unset; border-color:gold;"
 	disabled></button>

	<text id="best_score" style="position: absolute; 
	top:285px; left:1224px; text-align: center;
	text-shadow: 2px 2px 0px gold;
	font-family: Ink Free; font-size: 40px;"
	>0</text>


</div>


<div class="Rules" style="position: absolute; top:5px; left:5px;">
<text id="rules0" style="position: relative; top:0px; left:0px; text-align: center; text-shadow: 1px 1px 0px white; font-family: Ink Free; font-size: 15px;"
>
<b>Click START GAME to play and SPACE to put the game in pause.</b>
</text>
<p></p>
<text id="rules1" style="position: relative; top:0px; left:65px; text-align: center; text-shadow: 1px 1px 0px white; font-family: Ink Free; font-size: 15px;"
>
<b>To move the snake use the arrows.</b>
</text>
	
<button id = "arrowUp"; style="position: absolute; top:22.5px;left:328.5px; background-color:unset; border-color:black; border-style:solid " disabled>&#8593 </button>
<button id = "arrowLeft"; style="position: absolute; top:45.5px;left:302.5px; background-color:unset; border-color:black; border-style:solid" disabled>&#8592 </button>
<button id = "arrowDown"; style="position: absolute; top:45.5px;left:328.5px; background-color:unset; border-color:black; border-style:solid" disabled>&#8595 </button>
<button id = "arrowRight"; style="position: absolute; top:45.5px;left:348.5px; background-color:unset; border-color:black; border-style:solid" disabled>&#8594 </button>

<p></p>
<text id="rules2" style="position: relative; top:0px; left:40px; text-align: center; text-shadow: 1px 1px 0px white; font-family: Ink Free; font-size: 15px;"
>
<b>Eat the red fruit and stay away violet fruit.</b>
</text>
<p></p>
<text id="rules3" style="position: relative; top:0px; left:145px; text-align: center; text-shadow: 1px 1px 0px white; font-family: Ink Free; font-size: 15px;"
>
<b>GOOD LUCK!</b>
</text>
</div>

<div id="Scenario" style="position: absolute; top:628px; left:26px; bottom: 13px; font-family: Ink Free;">
<b>Scenario:</b>
<select id="Texture Style" size="1" style="position: relative; top:0px;left:0px; font-family: Ink Free"
title="Choose the scenario">
	<option value="0">Grass field</option>
    	<option value="1">No grass blades</option>
    	<option value="2">No limits</option>
	<option value="3">Night</option>
	<option value="4">3D object style</option>
	<option value="5">Blue</option>
	<option value="6">2D-style</option>
</select>
</div>

<div id="InfoModal" class="modal" style ="position: fixed; z-index: 1; padding-top: 100px; left: 0;
top: 0; width: 100%; height: 100%; overflow: auto;
background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.4);">
  <div class="modal-content" style="background-color: gold;
  	margin: auto; padding: 20px; border: 1px solid #888;
	width: 50%; font-family: Ink Free; 
	max-height: calc(100vh - 210px); overflow-y: auto;">
    	
	<span class="close" style = "  color: #aaaaaa;
	float: right; font-size: 28px; font-weight:
	bold">&times;</span>
    	<h2>Welcome to Snake 3D Game!</h2>

<p>You can prove the classical snake 2D game experience in the third dimension. Enjoy to change scenarios, to modify the kind of projection or to play on the fullscreen.</p>
<p>Before...some commands you can find useful to live the game at 100%:</p>
<p>To move the <b>snake</b> on the game field you must use the arrows</p>
<p>- <b>Arrow up</b> to go <b>UP</b></p>
<p>- <b>Arrow left</b> to go <b>LEFT</b></p>
<p>- <b>Arrow right</b> to go <b>RIGHT</b></p>
<p>- <b>Arrow down</b> to go <b>DOWN</b></p>
<p>...okay... It was pretty intuitive...</p>
<br></br>
<p>- <b>Space key</b> to <b>start</b> or put in <b>pause</b> the game</p>
<p>- <b>Enter key</b> to <b>reset</b> the camera and game field changes</p>
<p>- <b>Esc key</b> to <b>resize</b> correctly the canvas at the end of the fullscreen representation</p>
<br></br>
<p>To <b>rotate</b> or <b>translate</b> the <b>game field</b> on the canvas you can use the following keys</p>
<p>- <b>1</b> to translate game field towards the <b>x positive semiaxis</b></p>
<p>- <b>2</b> to translate game field towards the <b>x negative semiaxis</b></p>
<p>- <b>3</b> to translate game field towards the <b>y positive semiaxis</b></p>
<p>- <b>4</b> to translate game field towards the <b>y negative semiaxis</b></p>
<p>- <b>5</b> to translate game field towards the <b>z positive semiaxis</b></p>
<p>- <b>6</b> to translate game field towards the <b>z negative semiaxis</b></p>
<p>- <b>7</b> to rotate game field along <b>x axis</b></p>
<p>- <b>8</b> to rotate game field along <b>y axis</b></p>
<p>- <b>9</b> to rotate game field along <b>z axis</b></p>
<br></br>
<p>To move the <b>camera</b> you can use the following keys</p>
<p>- <b>A</b> to <b>increase x component</b> of eye vector</p>
<p>- <b>D</b> to <b>decrease x component</b> of eye vector</p>
<p>- <b>W</b> to <b>increase y component</b> of eye vector</p>
<p>- <b>S</b> to <b>decrease y component</b> of eye vector</p>
<p>- <b>E</b> to <b>increase z component</b> of eye vector</p>
<p>- <b>R</b> to <b>decrease z component</b> of eye vector</p>
<p>- <b>F</b> to <b>increase the depth</b> of the camera</p>
<p>- <b>N</b> to <b>decrease the depth</b> of the camera</p>
<p>- <b>+</b> to <b>increase</b> the field of view y-axis</p>
<p>- <b>Â­-</b> to <b>decrease</b> the field of view y-axis</p>
  
	</div>
</div>

<div id="FullScreen" style="position: absolute; top:610px; left:1180px; bottom: 13px">

	<button id = "info_button"
	style="width: 50px; height: 50px;
	position: relative; top:5px; left:-50px;
	background-color: blue; font-size: 40px;
	font-style: oblique; font-family:Ink Free; color: white;
	border-color: white; 
	border-style: solid; border-radius: 50%"
	title="Click to open the information panel">
	<b>i</b></button>

	<button id = "full_screen_button"
	style="width: 150px; height: 50px; 
	position: relative; top:-15px; left:-20px;
	background-color: unset; font-size: 20px;
	font-style: oblique; font-family:Ink Free; border: black;
	border-style: solid; border-radius: 10px"
	title="Click two times on ESC key to resize the canvas">	<b>FULL SCREEN</b></button>

	<button id = "restart_button"
	style="width: 150px; height: 25px; 
	position: relative; top:-10px; left:35px;
	background-color: #ff8c009c; font-size: 15px;
	font-style: oblique; font-family:Ink Free; border: black;
	border-style: solid; border-radius: 10px;"
	title="The button will activate at the end of the game">
	<b>RESTART</b></button>


</div>

<div id="Projection" style="position: absolute; top:662px; left:20px; bottom: 13px">

	<input type="radio" name="projection" id="persproj" 	value="perspective" style="position: relative;
	top:4px; left:0px" checked>
	<label for="persproj" style="position: relative; 	
	top:2px; left:0px; font-family: Ink Free;"
	title="Click to set perspective projection">
	<b>Perspective projection</b></label>

	<input type="radio" name="projection" id="orthproj" 	value="orthogonal" style="margin-left:1cm;
	position: relative; top:5px; left:0px">
	<label for="orthproj" style="position: relative; 
	top:5px; left:0px; font-family: Ink Free;"
	title="Click to set orthogonal projection">
	<b>Orthogonal projection</b></label>

</div>

<button id = "audio_button"
style="width: 70px; height: 35px; 
position: relative; top:295px; left:18px;
background-color: white; font-size: 16px;
font-style: oblique; font-family: Ink Free; border: black;
border-style: solid; border-radius: 10px"
title="Click to mute the music or reactivate it">
<b> Audio </b></button>

<audio id="audio1" src="../Soundtracks/Snake III JAVA game theme song.mp3"></audio>
<audio id="audio2" src="../Soundtracks/Jeopardy Theme.mp3"></audio>
<audio id="audio3" src="../Soundtracks/The Price is Right Losing Horn - Gaming Sound Effect (HD).mp3"></audio>
<audio id="audio4" src="../Soundtracks/Eat Munch 2 Sound Effect.mp3"></audio>
<audio id="audio5" src="../Soundtracks/Waterflame - Jumper.mp3"></audio>
<audio id="audio6" src="../Soundtracks/Bb Blues (110bpm) Backing track.mp3"></audio>
<audio id="audio7" src="../Soundtracks/Pokemon ost-Lavandonia.mp3"></audio>
</body>

<script id="vertex-shader" type="x-shader/x-vertex">
#version 300 es

in vec4 aPosition;
in vec4 aColor;
in vec3 aNormal;
in vec2 aTexCoord;

out vec4 vPosition;
out vec4 vColor;
out vec2 vTexCoord;
out vec4 vAmbientProduct,vDiffuseProduct,vSpecularProduct;
out vec3 vN, vE, vL;
out vec3 vLightDirection;
out float vShininess;

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat3 normalMatrix;
uniform float pointSize;

uniform vec4 uLightPosition;
uniform vec4 uAmbientProduct,uDiffuseProduct,uSpecularProduct;
uniform float uShininess;

void main()
{
	vec4 eyePosition = modelViewMatrix * aPosition;
	vLightDirection = normalize(
		(eyePosition - uLightPosition).xyz
	);

	vAmbientProduct  = uAmbientProduct;
	vDiffuseProduct  = uDiffuseProduct;
	vSpecularProduct = uSpecularProduct;
	vShininess       = uShininess;
	vN               = normalize(normalMatrix * aNormal);


	if (uLightPosition.w == 0.0)
		vL = normalize(
			(modelViewMatrix *
			 uLightPosition).xyz
		);

	else
	{
		vL = normalize(
			(modelViewMatrix *
			 uLightPosition - 
			 eyePosition).xyz
		);
    
		vec3 D = -(vLightDirection);
		float SLcosine = dot(D,vL);
	}

	vE = normalize(-eyePosition.xyz);


    	gl_Position = projectionMatrix
			* modelViewMatrix
			* aPosition;
    	vPosition    = aPosition;
    	vColor       = aColor;
	vTexCoord    = aTexCoord;
    	gl_PointSize = pointSize;

}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">
#version 300 es

precision mediump float;

in vec4 vPosition;
in vec4 vColor;
in vec2 vTexCoord;
in vec4 vAmbientProduct,vDiffuseProduct,vSpecularProduct;
in vec3 vN, vE, vL;
in vec3 vLightDirection;
in float vShininess;

out vec4 fColor;

uniform int isSnake;
uniform int uTextureCase;
uniform sampler2D uTex0;
uniform sampler2D uTex1;
uniform sampler2D uTex2;

void main()
{
		vec3 H = normalize(vL + vE);

		float Kd = max(dot(vL,vN), 0.0);
		float Ks = pow(
			max(dot(vN,H), 0.0),
			vShininess
		);

		vec4 ambient  = vAmbientProduct;
		vec4 diffuse  = Kd * vDiffuseProduct;
		vec4 specular = Ks * vSpecularProduct;
		if (dot(vL,vN)< 0.0) 
			specular = vec4(0.0,0.0,0.0,1.0);
    	
		vec4 ObjColor = (specular + diffuse + ambient);
		ObjColor.a = 1.0;

    		vec3 normal;
		vec4 color;

	if(isSnake == 1)
  	{	
    		normal.x = -2.0*(gl_PointCoord.x - 0.5);
    		normal.y = -2.0*(gl_PointCoord.y - 0.5);
    		normal.z = 1.0-normal.x*normal.x-normal.y*normal.y;
    		if(normal.z <= 0.0)  discard;
    		normal.z = sqrt(normal.z);

		Kd = max(dot(vL,normal), 0.0);
		Ks = pow(
			max(dot(normal,H), 0.0),
			vShininess
		);
		ambient  = vAmbientProduct;
		diffuse  = Kd * vDiffuseProduct;
		specular = Ks * vSpecularProduct;
		if (dot(vL,normal)< 0.0) 
			specular = vec4(0.0,0.0,0.0,1.0);    	
		
		ObjColor = (specular + diffuse + ambient);
		ObjColor.a = 1.0;

		if (uTextureCase == 5)
			color = vec4(0.0132,0.574,0.660,1.0);
		else if (uTextureCase == 4) 
			color = vec4(0.8*(vPosition.xyz + 1.0), 1.0); 
		else if (uTextureCase == 6)
			color = vec4(0.0,0.0,0.0,1.0);
		else color = vColor;
		fColor = color * ObjColor;
	}

	else if(isSnake == 2)
	{
    		normal.x = -2.0*(gl_PointCoord.x - 0.5);
    		normal.y = -2.0*(gl_PointCoord.y - 0.5);
    		normal.z = 1.0-normal.x*normal.x-normal.y*normal.y;
    		if(normal.z <= 0.0)  discard;
    		normal.z = sqrt(normal.z);

		Kd = max(dot(vL,normal), 0.0);
		Ks = pow(
			max(dot(normal,H), 0.0),
			vShininess
		);
		ambient  = vAmbientProduct;
		diffuse  = Kd * vDiffuseProduct;
		specular = Ks * vSpecularProduct;
		if (dot(vL,normal)< 0.0) 
			specular = vec4(0.0,0.0,0.0,1.0);    	

		ObjColor = (specular + diffuse + ambient);
		ObjColor.a = 1.0;
		
		if (uTextureCase == 6)
			color = vec4(0.77,0.0154,0.0154,1);
		else color = vColor * ObjColor;
		
		fColor = color;

  	}
	else if(isSnake == 3)
	{
    		normal.x = -2.0*(gl_PointCoord.x - 0.5);
    		normal.y = -2.0*(gl_PointCoord.y - 0.5);
    		normal.z = 1.0-normal.x*normal.x-normal.y*normal.y;
    		if(normal.z <= 0.0)  discard;
    		normal.z = sqrt(normal.z);

		Kd = max(dot(vL,normal), 0.0);
		Ks = pow(
			max(dot(normal,H), 0.0),
			vShininess
		);
		ambient  = vAmbientProduct;
		diffuse  = Kd * vDiffuseProduct;
		specular = Ks * vSpecularProduct;
		if (dot(vL,normal)< 0.0) 
			specular = vec4(0.0,0.0,0.0,1.0);    	
		
		ObjColor = (specular + diffuse + ambient);
		ObjColor.a = 1.0;
		
		if (uTextureCase == 6)
			color = vec4(0.489,0.0100,1.00,1.0);
		else 	color = vColor * ObjColor;;
		
		fColor = color;
  	}
	else if(isSnake == 4)
		fColor = vColor;

	else if(isSnake == 5)
	{
    		normal.x = -2.0*(gl_PointCoord.x - 0.5);
    		normal.y = -2.0*(gl_PointCoord.y - 0.5);
    		normal.z = 1.0-normal.x*normal.x-
		normal.y*normal.y;
    		if(normal.z <= 0.0)  discard;
    		normal.z = sqrt(normal.z);

   		vec2 i = vec2(1.0,1.0);
    		vec2 uv = gl_PointCoord.xy/i;
    		vec2 pos = 0.5 - uv;
    		pos.y /= i.x/i.y;
    		float dist = 1.0/length(pos);
    
    		dist *= 0.2;
		dist = pow(dist, 0.9);
	
		vec3 col = dist * vec3(1.0, 0.5, 0.25);
		col = 1.0 - exp( -col*2.0 );

		if (uTextureCase == 3 || uTextureCase == 5)
			fColor = vec4(col, 1.0)*2.0
			* vec4(0.537,0.910,0.879,1.0);

		else if (uTextureCase == 4)
			fColor = vec4(col, 1.0)*2.0
			* vec4(0.8*(vPosition.xyz + 1.0), 1.0);

		else fColor = vec4(col, 1.0)*2.0;
	}

  	else
	{
		if (uTextureCase == 4)
		{
			color = vec4(0.6,0.6,0.6,1.0); 
			fColor = color * ObjColor
				* texture(uTex2, vTexCoord);
		}
		else if (uTextureCase == 5) 
		{
			if(vColor == vec4(0.344,1.0,0.18,1.0))
				color = vec4(0.517,0.884,0.940,1.0);
			if(vColor == vec4(0.650,0.338,0.0260,1.0))
				color = vec4(0.00,0.240,0.720,1.0);
			
			fColor = color * ObjColor
				* texture(uTex0, vTexCoord)
				* texture(uTex1, vTexCoord);

		}
		else if (uTextureCase == 6)
		{
			color = vColor;
			fColor = color
				* texture(uTex0, vTexCoord)
				* texture(uTex1, vTexCoord);
		} 
		else
		{
			color = vColor;
			fColor = color * ObjColor
				* texture(uTex0, vTexCoord)
				* texture(uTex1, vTexCoord);
		}
	}
}
</script>

<script type="text/javascript" src="../Common/initShaders.js"></script>
<script type="text/javascript" src="../Common/MVnew.js"></script>
<script type="text/javascript" src="Snake3D.js"></script>

</html>
